<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Time Balance è¨ˆåˆ† APP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }
    body {
      margin: 0;
      padding: 16px;
      background: #f5f5f8;
      color: #222;
    }
    h1, h2, h3 {
      margin: 0 0 8px;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
    }
    .card {
      background: #fff;
      border-radius: 16px;
      padding: 16px 20px;
      margin-bottom: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }
    .flex {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    label {
      font-size: 14px;
    }
    input[type="text"], input[type="number"] {
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      min-width: 0;
    }
    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      background: #4f46e5;
      color: #fff;
      font-weight: 600;
      transition: transform 0.05s ease, box-shadow 0.05s ease,
        background 0.15s ease;
      box-shadow: 0 3px 8px rgba(79, 70, 229, 0.35);
      white-space: nowrap;
    }
    button.secondary {
      background: #e5e7eb;
      color: #111827;
      box-shadow: none;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(79, 70, 229, 0.4);
    }
    button.secondary:hover {
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }
    button:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #eef2ff;
      color: #3730a3;
      margin-left: 4px;
    }
    .player-pill {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: #e5e7eb;
      font-size: 13px;
      margin: 4px 4px 0 0;
    }
    .player-pill span {
      margin-right: 6px;
    }
    .player-pill button {
      padding: 0 6px;
      font-size: 12px;
      background: transparent;
      box-shadow: none;
      color: #6b7280;
    }
    .player-card {
      margin-top: 10px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 10px 12px;
      background: #f9fafb;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 13px;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 4px;
      text-align: center;
    }
    th {
      background: #f3f4f6;
    }
    input.score {
      width: 60px;
    }
    .results-table {
      margin-top: 8px;
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .results-table th, .results-table td {
      border: 1px solid #e5e7eb;
      padding: 6px 4px;
      text-align: center;
      vertical-align: top;
    }
    .results-table th {
      background: #f3f4f6;
    }
    .winner-row {
      background: #ecfdf5;
    }
    .winner-label {
      color: #047857;
      font-weight: 600;
      font-size: 12px;
    }
    .personality {
      text-align: left;
      font-size: 12px;
      line-height: 1.4;
    }
    @media (max-width: 640px) {
      table, .results-table {
        font-size: 12px;
      }
      input.score {
        width: 45px;
      }
      button {
        font-size: 13px;
        padding: 6px 12px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Time Balance è¨ˆåˆ† APP</h1>
      <p style="font-size:14px;margin-bottom:4px;">
        ç™»è¨˜äº”å›åˆçš„ã€Œå­¸ç¿’ãƒ»å¥åº·ãƒ»ç¤¾äº¤ãƒ»å¿ƒæƒ…ã€åˆ†æ•¸ï¼ŒçµæŸæ™‚è¨ˆç®—å¹³è¡¡å·®è·èˆ‡äººæ ¼é¡å‹ã€‚
      </p>
      <p style="font-size:12px;color:#6b7280;">
        å‹åˆ©æ¢ä»¶ï¼šå¹³è¡¡å·®è· = Max(å­¸ç¿’, å¥åº·, ç¤¾äº¤, å¿ƒæƒ…) âˆ’ Min(å­¸ç¿’, å¥åº·, ç¤¾äº¤, å¿ƒæƒ…)ï¼Œå·®è·è¶Šå°è€…ç²å‹ã€‚
      </p>
    </div>

    <!-- ç©å®¶è¨­å®š -->
    <div class="card" id="setup-card">
      <h2>1. æ–°å¢ç©å®¶</h2>
      <div class="flex" style="margin-top:8px;">
        <label>ç©å®¶åç¨±ï¼š</label>
        <input type="text" id="playerNameInput" placeholder="ä¾‹å¦‚ï¼šå°æ˜" />
        <button id="addPlayerBtn">åŠ å…¥ç©å®¶</button>
      </div>
      <div id="playerList" style="margin-top:8px;"></div>
      <div style="margin-top:12px;">
        <button id="startGameBtn" class="secondary">é–‹å§‹è¨˜éŒ„äº”å›åˆ</button>
      </div>
      <p style="font-size:12px;color:#6b7280;margin-top:8px;">
        å»ºè­°ï¼šè‡³å°‘æ–°å¢ 1 ä½ç©å®¶ã€‚ç©å®¶é–‹å§‹å¾Œä»å¯å›ä¾†ä¿®æ”¹åå­—ï¼ˆä½†ä¸å»ºè­°åˆªé™¤é¿å…è³‡æ–™éºå¤±ï¼‰ã€‚
      </p>
    </div>

    <!-- è¨˜åˆ†å€ -->
    <div class="card" id="score-card" style="display:none;">
      <h2>2. æ¯å›åˆåˆ†æ•¸ç™»è¨˜</h2>
      <p style="font-size:13px;color:#4b5563;margin-bottom:4px;">
        æ¯ä½ç©å®¶å…±æœ‰ <strong>5 å›åˆ</strong>ï¼Œè«‹å¡«å¯«å„å›åˆçš„å­¸ç¿’ã€å¥åº·ã€ç¤¾äº¤ã€å¿ƒæƒ…åˆ†æ•¸èˆ‡ç¸½è€—æ™‚ã€‚
      </p>
      <div id="playersScoreArea"></div>

      <div style="margin-top:12px;" class="flex">
        <button id="calcBtn">3. è¨ˆç®—çµæœ &amp; äººæ ¼åˆ†æ</button>
        <button id="backToSetupBtn" class="secondary">å›åˆ°ç©å®¶è¨­å®š</button>
      </div>
    </div>

    <!-- çµæœå€ -->
    <div class="card" id="result-card" style="display:none;">
      <h2>4. çµæœç¸½è¦½</h2>
      <div id="winnerDisplay" style="margin:6px 0 10px;font-size:13px;font-weight:600;color:#16a34a;"></div>
      <div id="resultsTableContainer"></div>
    </div>
  </div>

  <script>
    const players = []; // {id, name}

    const playerNameInput = document.getElementById("playerNameInput");
    const addPlayerBtn = document.getElementById("addPlayerBtn");
    const startGameBtn = document.getElementById("startGameBtn");
    const playerListDiv = document.getElementById("playerList");

    const setupCard = document.getElementById("setup-card");
    const scoreCard = document.getElementById("score-card");
    const playersScoreArea = document.getElementById("playersScoreArea");
    const calcBtn = document.getElementById("calcBtn");
    const backToSetupBtn = document.getElementById("backToSetupBtn");

    const resultCard = document.getElementById("result-card");
    const winnerDisplay = document.getElementById("winnerDisplay");
    const resultsTableContainer = document.getElementById("resultsTableContainer");

    let nextPlayerId = 0;
    const ROUNDS = 5;

    function renderPlayerList() {
      if (players.length === 0) {
        playerListDiv.innerHTML =
          '<p style="font-size:13px;color:#6b7280;">ç›®å‰æ²’æœ‰ç©å®¶ï¼Œè«‹å…ˆæ–°å¢ã€‚</p>';
        return;
      }
      let html = '<div style="margin-top:4px;">';
      players.forEach(p => {
        html += `
          <span class="player-pill">
            <span>${p.name}</span>
            <button type="button" onclick="renamePlayer(${p.id})">âœï¸</button>
            <button type="button" onclick="removePlayer(${p.id})">âœ•</button>
          </span>
        `;
      });
      html += "</div>";
      playerListDiv.innerHTML = html;
    }

    function addPlayer(name) {
      if (!name || !name.trim()) return;
      players.push({ id: nextPlayerId++, name: name.trim() });
      renderPlayerList();
    }

    function removePlayer(id) {
      const idx = players.findIndex(p => p.id === id);
      if (idx >= 0) {
        if (!confirm("åˆªé™¤ç©å®¶æœƒå¤±å»è©²ç©å®¶çš„å›åˆè³‡æ–™ï¼Œç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ")) return;
        players.splice(idx, 1);
        renderPlayerList();
      }
    }

    window.renamePlayer = function (id) {
      const p = players.find(p => p.id === id);
      if (!p) return;
      const newName = prompt("è«‹è¼¸å…¥æ–°çš„ç©å®¶åç¨±ï¼š", p.name);
      if (newName && newName.trim()) {
        p.name = newName.trim();
        renderPlayerList();
        renderScoreTables();
      }
    };

    addPlayerBtn.addEventListener("click", () => {
      addPlayer(playerNameInput.value);
      playerNameInput.value = "";
      playerNameInput.focus();
    });

    playerNameInput.addEventListener("keyup", e => {
      if (e.key === "Enter") {
        addPlayer(playerNameInput.value);
        playerNameInput.value = "";
      }
    });

    startGameBtn.addEventListener("click", () => {
      if (players.length === 0) {
        alert("è«‹å…ˆæ–°å¢è‡³å°‘ä¸€ä½ç©å®¶ï¼");
        return;
      }
      setupCard.style.display = "none";
      scoreCard.style.display = "block";
      renderScoreTables();
    });

    backToSetupBtn.addEventListener("click", () => {
      setupCard.style.display = "block";
      scoreCard.style.display = "none";
    });

    function renderScoreTables() {
      if (players.length === 0) {
        playersScoreArea.innerHTML =
          '<p style="font-size:13px;color:#6b7280;">å°šæœªæ–°å¢ç©å®¶ã€‚</p>';
        return;
      }
      let html = "";
      players.forEach((p, pi) => {
        html += `
          <div class="player-card">
            <div class="flex" style="justify-content:space-between;">
              <h3>${p.name}</h3>
              <span class="badge">ç©å®¶ ${pi + 1}</span>
            </div>
            <table>
              <thead>
                <tr>
                  <th>å›åˆ</th>
                  <th>å­¸ç¿’</th>
                  <th>å¥åº·</th>
                  <th>ç¤¾äº¤</th>
                  <th>å¿ƒæƒ…</th>
                  <th>ç¸½è€—æ™‚ (å°æ™‚)</th>
                </tr>
              </thead>
              <tbody>
        `;
        for (let r = 1; r <= ROUNDS; r++) {
          html += `
            <tr>
              <td>${r}</td>
              <td><input class="score" type="number" id="p${p.id}_r${r}_L" /></td>
              <td><input class="score" type="number" id="p${p.id}_r${r}_H" /></td>
              <td><input class="score" type="number" id="p${p.id}_r${r}_S" /></td>
              <td><input class="score" type="number" id="p${p.id}_r${r}_M" /></td>
              <td><input class="score" type="number" id="p${p.id}_r${r}_T" /></td>
            </tr>
          `;
        }
        html += `
              </tbody>
            </table>
          </div>
        `;
      });
      playersScoreArea.innerHTML = html;
    }

    function getNumberValue(id) {
      const el = document.getElementById(id);
      if (!el) return 0;
      const v = Number(el.value);
      return isNaN(v) ? 0 : v;
    }

    function classifyPersonality(L, H, S, M, TOTAL, BAL) {
      const scores = [
        { key: "å­¸ç¿’", value: L },
        { key: "å¥åº·", value: H },
        { key: "ç¤¾äº¤", value: S },
        { key: "å¿ƒæƒ…", value: M }
      ];
      scores.sort((a, b) => b.value - a.value);
      const maxDim = scores[0];
      const secondDim = scores[1];
      const diffTop2 = maxDim.value - secondDim.value;

      // è¦å‰‡ 1ï¼šé«˜å¹³è¡¡ + é«˜æŠ•å…¥
      if (BAL <= 5 && TOTAL >= 120) {
        return "ã€å…¨æ–¹ä½å¹³è¡¡é«˜æ‰‹ã€‘\nä½ çš„å››å€‹é¢å‘éå¸¸å¹³å‡ï¼Œæ•´é«”åˆ†æ•¸ä¹Ÿå¾ˆé«˜ï¼Œä»£è¡¨ä½ æ—¢é¡˜æ„æŠ•å…¥ï¼Œåˆæ‡‚å¾—å…¼é¡§å­¸ç¿’ã€å¥åº·ã€ç¤¾äº¤èˆ‡å¿ƒæƒ…ï¼Œæ˜¯æ¨™æº–çš„æ™‚é–“ç®¡ç†ç‹è€…ã€‚";
      }
      // è¦å‰‡ 2ï¼šé«˜å¹³è¡¡ + ä¸­ï¼ä½æŠ•å…¥
      if (BAL <= 5 && TOTAL < 120) {
        return "ã€æ‚ å“‰å¹³è¡¡ç”Ÿæ´»å®¶ã€‘\nä½ åœ¨å››å€‹é¢å‘ä¹‹é–“ç¶­æŒäº†ä¸éŒ¯çš„å¹³è¡¡ï¼Œé›–ç„¶æ•´é«”æŠ•å…¥ä¸ç®—çˆ†é‡ï¼Œä½†å·²ç¶“æ‰¾åˆ°é©åˆè‡ªå·±çš„ç”Ÿæ´»ç¯€å¥ï¼Œé‡è¦–çš„æ˜¯ç©©å®šèˆ‡å‰›å‰›å¥½çš„æ­¥èª¿ã€‚";
      }

      // è¦å‰‡ 3ï¼šå¤±è¡¡ + æŸä¸€é¢å‘æ˜é¡¯é ˜å…ˆ
      if (BAL > 10 && diffTop2 >= 5) {
        switch (maxDim.key) {
          case "å­¸ç¿’":
            return "ã€å­¸ç¿’è¡åˆºå‹ã€‘\nä½ åœ¨å­¸ç¿’ä¸Šçš„æŠ•å…¥é é«˜æ–¼å…¶ä»–é¢å‘ï¼Œç›®æ¨™æ„Ÿèˆ‡æ±‚çŸ¥æ…¾å¾ˆå¼·ã€‚ä¸éä¹Ÿè¦å°å¿ƒåˆ¥è®“å£“åŠ›å£“ç¸®äº†å¥åº·ã€ç¤¾äº¤æˆ–å¿ƒæƒ…çš„ç©ºé–“ã€‚";
          case "å¥åº·":
            return "ã€å¥åº·å®ˆé–€å“¡ã€‘\nä½ éå¸¸é‡è¦–èº«é«”ç‹€æ…‹èˆ‡ä½œæ¯ï¼Œé¡˜æ„ç‚ºäº†é•·é ç‹€æ…‹åšé¸æ“‡ã€‚è¨˜å¾—å¶çˆ¾ä¹Ÿçµ¦è‡ªå·±ä¸€é»å½ˆæ€§ï¼Œåˆ¥å› ç‚ºå¤ªåš´æ ¼è€ŒéŒ¯éä¸€äº›æœ‰è¶£çš„ç¤¾äº¤èˆ‡é«”é©—ã€‚";
          case "ç¤¾äº¤":
            return "ã€ç¤¾äº¤é€£çµè€…ã€‘\nä½ å¾äººéš›äº’å‹•èˆ‡æ´»å‹•ä¸­ç²å¾—èƒ½é‡ï¼Œæ˜¯å¾ˆæœ‰å­˜åœ¨æ„Ÿçš„å¤¥ä¼´ã€‚ä½†å¦‚æœç¤¾äº¤åˆ†æ•¸é«˜ã€å­¸ç¿’æˆ–å¥åº·åä½ï¼Œå¯èƒ½ä»£è¡¨ä½ åœ¨ç©æ¨‚èˆ‡è²¬ä»»ä¹‹é–“é‚„æœ‰èª¿æ•´ç©ºé–“ã€‚";
          case "å¿ƒæƒ…":
            return "ã€å¿«æ¨‚è¿½å°‹è€…ã€‘\nä½ å¾ˆåœ¨æ„ç•¶ä¸‹çš„å¿ƒæƒ…èˆ‡æƒ…ç·’å“è³ªï¼Œæœƒä¸»å‹•è¿½æ±‚è®“è‡ªå·±æ„Ÿåˆ°æ„‰å¿«çš„é¸æ“‡ã€‚è‹¥å¿ƒæƒ…åˆ†æ•¸å¾ˆé«˜ã€å­¸ç¿’æˆ–å¥åº·æ˜é¡¯åä½ï¼Œå¯èƒ½ä»£è¡¨ä½ æœ‰ä¸€é»é€ƒé¿å£“åŠ›çš„å‚¾å‘ã€‚";
        }
      }

      // è¦å‰‡ 4ï¼šé«˜ç”¢èƒ½ä½†å¤±è¡¡
      if (TOTAL >= 120 && BAL > 15) {
        return "ã€é«˜ç”¢èƒ½ä½†å¤±è¡¡çš„è¡åˆºè€…ã€‘\nä½ çš„ç¸½æŠ•å…¥åº¦éå¸¸é«˜ï¼Œä»£è¡¨ä½ è¡Œç¨‹æ»¿æ»¿ã€ç›¸ç•¶ç”¨åŠ›åœ¨ç”Ÿæ´»ã€‚ä½†å››å€‹é¢å‘å·®è·å¾ˆå¤§ï¼Œå¯èƒ½è¡¨ç¤ºä½ é•·æœŸåœ¨ã€æ‹¼æŸä¸€å¡Šã€ï¼Œå»çŠ§ç‰²äº†å…¶ä»–éœ€æ±‚ï¼Œå»ºè­°é©æ™‚èª¿æ•´ã€‚";
      }

      // è¦å‰‡ 5ï¼šä½æŠ•å…¥è§€å¯Ÿè€…
      if (TOTAL < 80) {
        return "ã€ä½æŠ•å…¥çš„è§€å¯Ÿè€…ã€‘\né€™æ¬¡éŠæˆ²ä¸­ï¼Œä½ åœ¨å„é¢å‘çš„ç¸½åˆ†åä½ï¼Œå¯èƒ½æ¯”è¼ƒåƒæ˜¯å…ˆè§€å¯Ÿè‡ªå·±çš„ç¿’æ…£ï¼Œè€Œé‚„æ²’é–‹å§‹ç©æ¥µèª¿æ•´ã€‚å¦‚æœä½ æƒ³æ”¹è®Šï¼Œå¯ä»¥å¾ä¸€å…©å€‹é¢å‘é–‹å§‹è¨­å°ç›®æ¨™å°±å¥½ã€‚";
      }

      // å…¶ä»–ï¼šæ··åˆå‹
      return "ã€æ··åˆå‹æ¢ç´¢è€…ã€‘\nä½ çš„åˆ†å¸ƒæ²’æœ‰ç‰¹åˆ¥æ¥µç«¯ï¼Œä»£è¡¨ä½ é‚„åœ¨æ‘¸ç´¢è‡ªå·±æœ€åœ¨æ„çš„æ˜¯å“ªå€‹é¢å‘ã€‚æœªä¾†å¯ä»¥è©¦è‘—æœ‰æ„è­˜åœ°èª¿æ•´ä¸€å…©å€‹é¢å‘ï¼Œçœ‹çœ‹å“ªç¨®é…æ¯”æœ€ç¬¦åˆä½ ç†æƒ³ä¸­çš„ç”Ÿæ´»ã€‚";
    }

    calcBtn.addEventListener("click", () => {
      if (players.length === 0) {
        alert("å°šæœªåŠ å…¥ç©å®¶ã€‚");
        return;
      }

      const results = [];

      players.forEach(p => {
        let L = 0, H = 0, S = 0, M = 0;
        let totalTime = 0;
        for (let r = 1; r <= ROUNDS; r++) {
          const l = getNumberValue(`p${p.id}_r${r}_L`);
          const h = getNumberValue(`p${p.id}_r${r}_H`);
          const s = getNumberValue(`p${p.id}_r${r}_S`);
          const m = getNumberValue(`p${p.id}_r${r}_M`);
          const t = getNumberValue(`p${p.id}_r${r}_T`);

          L += l;
          H += h;
          S += s;
          M += m;
          totalTime += t;
        }
        const TOTAL = L + H + S + M;
        const maxScore = Math.max(L, H, S, M);
        const minScore = Math.min(L, H, S, M);
        const BAL = maxScore - minScore;
        const personality = classifyPersonality(L, H, S, M, TOTAL, BAL);

        results.push({
          name: p.name,
          L, H, S, M,
          TOTAL,
          BAL,
          totalTime,
          personality
        });
      });

      // æ’åï¼æ‰¾å‡ºå‹è€…
      let bestBal = Infinity;
      let bestTotal = -Infinity;
      let winners = [];
      results.forEach(r => {
        if (r.BAL < bestBal || (r.BAL === bestBal && r.TOTAL > bestTotal)) {
          bestBal = r.BAL;
          bestTotal = r.TOTAL;
          winners = [r.name];
        } else if (r.BAL === bestBal && r.TOTAL === bestTotal) {
          winners.push(r.name);
        }
      });

      if (winners.length === 1) {
        winnerDisplay.textContent = `æœ¬å±€æœ€ä½³å¹³è¡¡ç©å®¶æ˜¯ï¼š${winners[0]} ğŸ†ï¼ˆå¹³è¡¡å·®è· ${bestBal}ï¼Œç¸½åˆ† ${bestTotal}ï¼‰`;
      } else {
        winnerDisplay.textContent =
          `æœ¬å±€æœ‰å¤šä½æœ€ä½³å¹³è¡¡ç©å®¶ï¼š${winners.join("ã€")} ğŸ†ï¼ˆå¹³è¡¡å·®è· ${bestBal}ï¼Œç¸½åˆ† ${bestTotal}ï¼‰`;
      }

      // çµæœè¡¨æ ¼
      let tableHtml = `
        <table class="results-table">
          <thead>
            <tr>
              <th>ç©å®¶</th>
              <th>å­¸ç¿’ç¸½åˆ†</th>
              <th>å¥åº·ç¸½åˆ†</th>
              <th>ç¤¾äº¤ç¸½åˆ†</th>
              <th>å¿ƒæƒ…ç¸½åˆ†</th>
              <th>å››é¢å‘ç¸½å’Œ</th>
              <th>å¹³è¡¡å·®è·</th>
              <th>ç¸½è€—æ™‚(åŠ ç¸½)</th>
              <th>äººæ ¼åˆ†æ</th>
            </tr>
          </thead>
          <tbody>
      `;

      results.forEach(r => {
        const isWinner = winners.includes(r.name);
        tableHtml += `
          <tr class="${isWinner ? "winner-row" : ""}">
            <td>
              ${r.name}
              ${isWinner ? '<div class="winner-label">ğŸ† æœ€ä½³å¹³è¡¡</div>' : ""}
            </td>
            <td>${r.L}</td>
            <td>${r.H}</td>
            <td>${r.S}</td>
            <td>${r.M}</td>
            <td>${r.TOTAL}</td>
            <td>${r.BAL}</td>
            <td>${r.totalTime}</td>
            <td class="personality">${r.personality.replace(/\n/g, "<br/>")}</td>
          </tr>
        `;
      });

      tableHtml += "</tbody></table>";
      resultsTableContainer.innerHTML = tableHtml;
      resultCard.style.display = "block";
    });
  </script>
</body>
</html>
